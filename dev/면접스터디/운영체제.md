# 운영체제

면접 스터디에 가입을 했지만 

1. 실제로 프로그래밍에서 어떻게 접목이 되는가? 
2. 공부하면 재미있는 부분인가? 
3. 실제로 공부하는 이론을 직접 볼수 있는가? 
4. 다른 프로그래머와 원활한 소통을 위한 공부
5. 다시 보았을 때 이해가 되는 dictionary 같은 존재

에 맞추어 공부를 했으면 좋겠다.

그리고 여러가지 자료를 보면서 어디서 공부를 하고 어느정도까지 공부를 하면 좋을까 많은 고민을 하였다.
그 중 학부 시절 때 최종무 교수님이 수업강의가 너무 재미있었기 때문에 다시 학과 자료를 펴서 공부를 해보기로 하였다.



## 1. 프로세스와 스레드의 차이

![image](https://user-images.githubusercontent.com/31977543/96371404-8e020700-119c-11eb-9685-db2508c39631.png)

## 프로그램
- 보조 기억장치(하드 디스크, SSD) 에 존재
- 실행되기를 기다리는 명령어(코드)와 정적인 데이터의 묶음.
- 프로그램이 디스크에서 메모리에 적재되면 프로세스가 된다.

### 프로세스 (Process)
- 실행중인 프로그램
- loaded : 디스크 -> 메모리 
    - CPU 의 할당을 받을 수 있음
- 주소공간, 파일, 메모리 등을 할당 받음
- 공간
    - 프로세스 스택 : 함수의 매개변수, 복귀주소, 로컬변수
    - 데이터 섹션 : 전역변수
    - 힙 : 프로세스 실행 중에 동적으로 할당되는 공간
    
### PCB 프로세스 제어 블록 Process Control Block
프로세스의 정보 저장소

#### 어떻게 만들어 지나? 
- 운영체제가 프로세스 생성과 동시에 고유한 PCB 생성

#### PCB 에 저장되는 정보
- 프로세스 식별자 (PID)
- 프로세스 상태 
    - new, ready, running, waiting, terminated 등
- 프로그램 카운터 (PC) 
- CPU 레지스터 
- CPU 스케줄링 정보
    - 프로세스 우선순위, 스케줄 큐에 대한 포인터 
- ~~메모리 관리 정보~~
    - ~~페이지 테이블, 세그먼트 테이블~~
- ~~입출력 상태 정보~~
    - ~~프로세스에 할당된 입출력 장치들, 열린 파일 목록 ...~~
- ~~Accounting 정보~~
    - ~~사용된 CPU 시간, 시간 제한, 계정번호~~

```text
#### 프로세스 상태
- 생성(new) : 프로세스가 생성되는 중이다.
- 실행(running) : 프로세스가 CPU 를 차지하여 명령어들이 실행되고 있다.
- 준비(ready) : 프로세스가 CPU를 사용하고 있지는 않지만 언제든지 사용할 수 있는 상태로, CPU가 할당되기를 기다리고 있다. 일반적으로 준비 상태의 프로세스 중 우선순위가 높은 프로세스가 CPU 를 할당받는다.
- 대기(waiting) : 보류(block)라고 부르기도 한다. 프로세스가 입출력 완료, 시그널 수신 등 어떤 사건을 기다리고 있는 상태를 말한다.
- 종료(terminated) : 프로세스의 실행이 종료되었다.
```
   
### 스레드 Thread
- 한 프로세스 내에서 동작되는 여러 실행 흐름
- 프로세스 내의 주소 공간이나 자원 공유

#### 스레드의 구성
- 스레드 ID
- PC
- 레지스터 집합
- 스택

#### 공유하는 자원
- ~~다른 스레드와의 코드~~
- ~~데이터 섹션~~
- ~~열린 파일~~
- ~~운영체제 자원~~

#### 스택을 스레드 마다 독립적으로 할당하는 이유
- 스택
    - 함수 호출시 전달되는 인자
    - 복귀 주소값
    - 함수내 선언된 변수

- 스택 메모리 공간이 독립적 -> 독립적인 함수 호출(독립적이 실행 흐름)

#### PC register 를 스레드마다 독립적으로 할당하는 이유
스레드는 CPU 를 할당받았다가 스케줄러에 의해 다시 선점당함
명령어가 어느부분까지 수행했는지 기억할 필요가 있음. 

## 2. 멀티 스레드


![image](https://user-images.githubusercontent.com/31977543/96371416-9bb78c80-119c-11eb-9347-e41f6c257a56.png)


### 멀티 스레딩의 장점
동시처리의 변경: 프로세스 -> 스레드
 
- 스레드간 통신 : 전역변수 공간 / Heap 을 이용
    - 스레드가 더 메모리 공간 / 시스템 자원 소모 절약
- Context switch
    - 프로세스 : 캐시 메모리를 비움
    - 스레드 : 캐시 메모리를 비우지 않음 
        - 문맥 전환이 빠르다
  
### 멀티 스레딩 문제점
- 스레드간 데이터와 힙 영역 공유
    - 다른 스레드에서 사용중인 변수나 자료구조에서 엉뚱한 값 READ/WRITE
- 동기화 작업 필요
    - 작업 처리 순서 제어
    - 공유자원 접근 제어
- 과도한 lock 으로 병목현상이 있을 수 있다.

### 멀티 스레드 vs 멀티 프로세스
멀티스레드
1. 적은 메모리 공간, 문맥전환이 빠름
2. 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다.
3. 동기화 문제

멀티 프로세스
1. 프로세스 하나가 죽더라도 다른 프로세스에 영향을 끼치지 않는다.
2. 멀티 스레드보다 더 많은 메모리 공간과 CPU 시간을 차지한다. 

결론
- 시스템 특징에 따라 방법을 선택한다.

## 3. 스케줄러

![image](https://user-images.githubusercontent.com/31977543/96371437-a96d1200-119c-11eb-8189-29ff07a0330e.png)


### 프로세스 스케줄링을 위한 Queue
1. Job Queue
    - 현재 시스템 내의, 모든 프로세스
2. Ready Queue
    - 현재 메모리에 있음
    - CPU 를 잡아서 실행되기를 기다리는 프로세스
3. Device Queue
    - Device I/O 작업을 대기하고 있는 프로세스의 집합

### 스케줄러의 종류
#### 1. 장기 스케줄러 (Long-term scheduler / job scheduler)
- 한정된 메모리에서 많은 프로세스들이 한꺼번에 올라올 경우
- 프로세스들은 대용량 메모리(일반적으로 디스크)에 임시로 저장됨
- pool 에 저장된 프로세스 중 ready queue 에 보낼 프로세스를 결정한다.
 
1. 메모리와 디스크 사이의 스케줄링
2. 프로세스에 메모리를 할당. 
3. 실행중인 프로세스의 수 제어

   
#### 2. 단기 스케줄러 (Short-term scheduler / CPU scheduler)
- CPU 와 메모리 사이의 스케줄링
- Ready Queue 에 존재하는 프로세스 중 running 프로세스를 결정한다.
- 프로세스에 CPU 를 할당

#### 3. 중기 스케줄러 (Medium-term scheduler / Swapper)
- 여유 공간 마련을 위해 프로세스 통째로 메모리에서 디스크로 내보낸다.(swapping)
- 메모리에 너무 많은 프로그램이 동시에 올라가는 것을 조절함
- 프로세스의 상태: ready -> suspended(stopped)

## 멀티 프로세싱, 멀티 프로그래밍, 멀티 태스킹

### 멀티 프로세싱 (멀티 코어 시스템)
하나 이상의 **프로세서**가 서로 협력하여 일을 처리
-> 멀티 프로세서가 **협력**하여 일 처리 

### 멀티 프로그래밍

### 멀티 태스킹




Reference
--
- https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/OS
- https://bowbowbow.tistory.com/16
- https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4
- DKU 최종무 교수님 운영체제 강의